

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Connectors Specifications &mdash; Connectors 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Connectors 0.1 documentation" href="index.html" />
    <link rel="prev" title="Welcome to Connectors’ documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="index.html" title="Welcome to Connectors’ documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Connectors 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="connectors-specifications">
<span id="id1"></span><h1>Connectors Specifications<a class="headerlink" href="#connectors-specifications" title="Permalink to this headline">¶</a></h1>
<p>The framework to develop connectors (like <a class="reference external" href="http://code.launchpad.net/magentoerpconnect">Magentoerpconnect</a>) is
decoupled in small pieces of codes interacting together.</p>
<p>This document describes the high-level specifications for each piece.</p>
<div class="section" id="events">
<h2>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h2>
<p>Events are hooks in OpenERP on which we can plug some actions. They are
based on an Observer pattern.</p>
<p>The basic idea is to declare an event, for instance <cite>on_record_create</cite>.
Then each connector is able to subscribe one or many function on it. The
creation of a record should fire <cite>on_record_create</cite>, and that will
trigger all the subscribed functions.</p>
<p>We must be able to:</p>
<ul class="simple">
<li>register a new function on an event</li>
<li>unregister a function from an event</li>
<li>so, it means also replace a function by another</li>
<li>filter the events by model, so a subscribed function will be triggered
only if the event happens on a registered model</li>
</ul>
</div>
<div class="section" id="queue">
<h2>Queue<a class="headerlink" href="#queue" title="Permalink to this headline">¶</a></h2>
<p>This section summarises the Queue which is in fact a grouping of 4
notions, which are tasks, jobs, a worker, and the queue itself.</p>
<blockquote>
<div><p>Tasks</p>
<blockquote>
<div>A task is basically a piece of code, for instance a function, which
can be used by a job. A task could be a function with some
arguments. No special requirements at this level.</div></blockquote>
<p>Job</p>
<blockquote>
<div><p>A job is a call of a <cite>task</cite> (with some arguments) waiting to be
executed. It is stored in the <cite>queue</cite> before it is executed.</p>
<p>It needs to store at least 2 things: the task to call and the
arguments to pass to it.</p>
<p>A job may need to be run at a certain time, for instance to delay a
failed task to a later time, or to defer some expensive tasks during
the night. So, a job could also have a &#8216;later time&#8217;.</p>
<p>We want some jobs to be run before others, according to a priority.
Thus they have to store a priority.</p>
<p>Jobs should be stored somewhere (PostgreSQL or other database) and
not just kept into memory, because they have to survive to an
OpenERP restart.</p>
</div></blockquote>
<p>Queue</p>
<blockquote>
<div>The queue stores the jobs before their execution. The queue has 2
responsibilities: queue a job, dequeue a job. It should respect the
priorities and the &#8216;later time&#8217; of the jobs.</div></blockquote>
<p>Worker</p>
<blockquote>
<div><p>The worker is started alongside OpenERP. Its role is to take the
jobs out of the queue and run them one per one. It can uses
thread(s) for instance.</p>
<p>When OpenERP start, it has to take all the pending jobs from the
database and queue them.</p>
</div></blockquote>
</div></blockquote>
<p>Potential issues:</p>
<ul class="simple">
<li>Start of the server: the pending jobs must be enqueued only in one
queue when we have many processes using Gunicorn.</li>
<li>Restart of processes: Gunicorn kills the processes based on some
resources or time limits. We have to ensure that: the jobs are still
in a queue, the jobs are not in 2 queues</li>
<li>Sop of the server: a job executed jobs just before the stop of the
server may be finished but not written as &#8216;done&#8217; in the database.</li>
</ul>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>A reference represents a service and a version, for instance <cite>Magento
1.7</cite>. It holds lists of mappings, synchronizers, external adapters and
binders available.</p>
<p>A reference can have a parent. The instance <cite>Magento 1.7</cite> is the child
of <cite>Magento</cite>.</p>
<p>We should be able to ask to a reference the mapping class to use. For
instance, if I ask the mapping class for <cite>res.partner</cite> to <cite>Magento 1.7</cite>,
it must return me the class to use. If <cite>Magento 1.7</cite> has no mapping
registered, it returns the mapping registered on its parent. Same story
for each type of classes.</p>
<p>We must be able to unregister or register each class.</p>
</div>
<div class="section" id="mappings">
<h2>Mappings<a class="headerlink" href="#mappings" title="Permalink to this headline">¶</a></h2>
<p>A mapping translates an external record to an OpenERP record and
conversely. This point is more complex than it can appear.</p>
<p>A mapping is applicable based on:</p>
<ul class="simple">
<li>a model</li>
<li>a direction (OpenERP -&gt; External, External -&gt; OpenERP)</li>
</ul>
<p>It should support:</p>
<ul class="simple">
<li>direct mappings: field <cite>a</cite> is written in field <cite>b</cite></li>
<li>method mappings: a method is used to convert one or many fields to one
or many fields</li>
<li>sub mappings: a sub record (lines of a sale order) is converted</li>
<li>fields selection: smart selection of records to convert (only few
fields have been modified on OpenERP, convert only them)</li>
<li>merge of records: convert 2 external records in 1 OpenERP record or
the reverse</li>
</ul>
</div>
<div class="section" id="synchronizers">
<h2>Synchronizers<a class="headerlink" href="#synchronizers" title="Permalink to this headline">¶</a></h2>
<p>A synchronizer is an action with the external system. It can be a
record&#8217;s import or export, a deletion of something, or anything else.
It will use the mappings to convert the data between both systems, the
external adapters to read or write data on the external system and the
binders to create the link between them.</p>
</div>
<div class="section" id="external-adapters">
<h2>External Adapters<a class="headerlink" href="#external-adapters" title="Permalink to this headline">¶</a></h2>
<p>An external adapter has a common interface to speak with the external
system. It translates the basic orders (search, read, write) to an
underlying communication with the external system.</p>
</div>
<div class="section" id="binders">
<h2>Binders<a class="headerlink" href="#binders" title="Permalink to this headline">¶</a></h2>
<p>Binders are classes which know how to find the external ID for an
OpenERP ID, how to find the OpenERP ID for an external ID and how to
create the binding between them.</p>
</div>
<div class="section" id="datamodel-changes">
<h2>Datamodel changes<a class="headerlink" href="#datamodel-changes" title="Permalink to this headline">¶</a></h2>
<p>The datamodel used in <a class="reference external" href="http://code.launchpad.net/magentoerpconnect">Magentoerpconnect</a> (and other connectors) in
version 6.1 is invasive. They add their own fields on each synchronized
models (products, partners, ...). This not only is a mess on the views,
but also becomes limitating for the extensibility of the connectors. For
instance, actually the Magento <cite>email</cite> fields is stored on
<cite>res.partner</cite>. The fact is that a partner could be shared between 2
Magento&#8217;s websites with different email. Product attributes may be
different per shop.</p>
<p>Another issue is the storage of the bindings between records in
<cite>ir.model-data</cite>. This model allows to store an external id, an openerp
id, a model and a a referential. This is a limitation when we need more
granularity in the bindings (<cite>website_id</cite> for a partner) or when there
is no external id but a couple of keys (product links).</p>
<p>The solution here is to properly stores the bindings on relation tables
between the referentials and the records <a class="reference internal" href="#figure-1">Figure 1</a>. These relation tables will
also be able to store the additional data like the product attributes.</p>
<div class="figure align-center" id="figure-1">
<img alt="New Datamodel for connectors V7.0" src="_images/09_datamodel.png" style="width: 50%;" />
<p class="caption">Datamodel structure for connectors V7.0</p>
</div>
</div>
<div class="section" id="naming">
<h2>Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h2>
<p>We need to agree on a clear naming for the concepts exposed here and some
of the existing ones.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Connectors Specifications</a><ul>
<li><a class="reference internal" href="#events">Events</a></li>
<li><a class="reference internal" href="#queue">Queue</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#mappings">Mappings</a></li>
<li><a class="reference internal" href="#synchronizers">Synchronizers</a></li>
<li><a class="reference internal" href="#external-adapters">External Adapters</a></li>
<li><a class="reference internal" href="#binders">Binders</a></li>
<li><a class="reference internal" href="#datamodel-changes">Datamodel changes</a></li>
<li><a class="reference internal" href="#naming">Naming</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to Connectors&#8217; documentation!</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/09_specifications.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="index.html" title="Welcome to Connectors’ documentation!"
             >previous</a> |</li>
        <li><a href="index.html">Connectors 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Guewen Baconnier (Camptocamp SA).
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>