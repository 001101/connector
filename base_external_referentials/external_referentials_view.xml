<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.ui.view" id="external_referential_search_view">
            <field name="name">external.referential.search.view</field>
            <field name="model">external.referential</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="External Referential">
                   <field name="name"/>
                   <field name="type_id"/>
                   <field name="categ_id"/>
                   <newline/>
                   <group  expand='0' string='Group by...' groups="base.group_extended">
                       <filter string='Category' icon="terp-stock_symbol-selection" domain="[]" context="{'group_by' : 'categ_id'}" />
                   </group>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="external_referential_form_view">
            <field name="name">external_referential_form_view</field>
            <field name="model">external.referential</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <group col="4" colspan="4">
                        <field name="name" attrs="{'readonly':[('create_date','!=',False)]}"/>
                        <field name="create_date" invisible="True"/>
                        <notebook colspan="4">
                            <page string="General">
                                <field name="version_id"/>
                                <field name="location"/>
                                <field name="categ_name" invisible="True"/>
                            </page>
                            <page string="Authentication">
                                <field name="apiusername" />
                                <field name="apipass" />
                            <!-- TODO improve view -->
                                <field name="debug" />
                            </page>
                        </notebook>
                    </group>
                    <group col="4" colspan="4">
                        <separator string="Core Components" colspan="4" />
                        <notebook colspan="4">
                            <page string="Referential Actions">
                                <separator string="Compulsory" colspan="4" />
                                <button name="refresh_mapping" string="1 - Reload Referential Mapping Templates" colspan="2" type="object" />
                                <button name="import_referentials" string="2 - Synchronize Referential Settings" colspan="2" type="object" attrs="{'readonly':[('mapping_ids','=',[])]}"/>
                            </page>
                            <page string="CSV file generation">
                                <button name="build_external_ref_type" string="Export referential type" colspan="2" type="object" />
                                <button name="build_external_ref_version" string="Export referential version" colspan="2" type="object"/>
                                <button name="build_external_mapping_template" string="Export mapping template" colspan="2" type="object"/>
                            </page>
                        </notebook>
                    </group>
                    <field name="mapping_ids" widget="one2many_list" nolabel="1">
                        <tree string="Object Mappings">
                            <field name="model_id" />
                            <field name="extra_name" />
<!--                            <field name="related_model_ids" invisible="1" />-->
<!--                            <field name="mapping_ids" />-->
                        </tree>
                        <form string="Object Mappings">
                            <field name="model_id" on_change="model_id_change(model_id)" />
                            <field name="extra_name" />
                            <field name="related_model_ids" invisible="1" />
                            <group col="4" colspan="4">
                                <field name="external_list_method" />
                                <field name="external_search_method" />
                                <field name="external_get_method" />
                                <field name="external_update_method" />
                                <field name="external_create_method" />
                                <field name="external_delete_method" />
                                <field name="external_done_method" />
                                <field name="key_for_external_id" />
                                <field name="external_resource_name" />
                            </group>
                            <button name="add_all_fields" string="Add all object fields" colspan="2" type="object" />
                            <button name="create_mapping_file" string="Export mapping file" colspan="2" type="object" />
                            <field colspan="4" name="mapping_ids" widget="one2many_list" nolabel="1" context="{'model_id':model_id}"/>
                        </form>
                    </field>
                </form>
            </field>
        </record>

<!-- External mapping line search views -->
        <record model="ir.ui.view" id="external_mapping_line_search_view">
            <field name="name">external.mapping_line.search.view</field>
            <field name="model">external.mapping.line</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Mapping line">
                   <field name="external_field"/>
                   <field name="name"/>
                   <field name="mapping_id" />
                </search>
            </field>
        </record>
<!-- External mapping line tree views -->
        <record id="external_mapping_line_tree_view" model="ir.ui.view">
            <field name="name">external_mapping_line_tree_view</field>
            <field name="model">external.mapping.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="selected" />
                    <field name="sequence" />
                    <field name="field_id" />
                    <field name="internal_field" />
                    <field name="external_field" />
                    <field name="external_type" />
                    <field name="type" />
                    <field name="alternative_key" />
                    <field name="name" />
                    <field name="mapping_id" />
                </tree>
            </field>
        </record>

<!-- External mapping line form views -->
        <record model="ir.ui.view" id="external_mapping_line_form_view">
            <field name="name">external_mapping_line_form_view</field>
            <field name="model">external.mapping.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <field name="selected" />
                    <field name="sequence" />
                    <field name="type" />
                    <field name="evaluation_type" />
                    <separator string="External fields" colspan="2"/>
                    <separator string="Internal fields" colspan="2"/>
                    <field name="external_field" select="1"/>
                    <field name="field_id" domain="[('model_id','=',parent.model_id)]" />
                    <field name="external_type" />
                    <field name="datetime_format" attrs="{'invisible':[('external_type','!=','datetime')]}"/>
                    <field name="internal_field" />
                    <field name="alternative_key" />
                    <field name="name" />
                    <field name="mapping_id" />
                    <field name="child_mapping_id" colspan="4" attrs="{'invisible':[('evaluation_type','!=','sub-mapping')]}"/>
                    <group attrs="{'invisible':[('evaluation_type','!=','function')]}" colspan="4">
                        <separator string="Import in OpenERP Mapping Python Function" colspan="2"/>
                        <separator string="Export from OpenERP Mapping Python Function" colspan="2"/>
                        <field name="in_function" colspan="2" nolabel="1"/>
                        <field name="out_function" colspan="2" nolabel="1"/>
                    </group>
                </form>
            </field>
        </record>


        <record id="external_referential_tree_view" model="ir.ui.view">
            <field name="name">external_referential_tree_view</field>
            <field name="model">external.referential</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name" select="1" />
                    <field name="location" select="1" />
                </tree>
            </field>
        </record>

        <record id="external_referential_version_form_view" model="ir.ui.view">
            <field name="name">external_referential_version_form_view</field>
            <field name="model">external.referential.version</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <field name="name" />
                    <field name="full_name" />
                    <field name="type_id"/>
                </form>
            </field>
        </record>

        <record id="external_referential_type_form_view" model="ir.ui.view">
            <field name="name">external_referential_type_form_view</field>
            <field name="model">external.referential.type</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <field name="name" />
                    <field name="categ_id" />
                    <field name="version_ids" colspan="4"/>
                </form>
            </field>
        </record>

    </data>
</openerp>
